(function(t){function e(e){for(var a,s,r=e[0],h=e[1],c=e[2],u=0,m=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&m.push(i[s][0]),i[s]=0;for(a in h)Object.prototype.hasOwnProperty.call(h,a)&&(t[a]=h[a]);l&&l(e);while(m.length)m.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,r=1;r<n.length;r++){var h=n[r];0!==i[h]&&(a=!1)}a&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},i={app:0},o=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],h=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var l=h;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"16d4":function(t,e,n){},2015:function(t,e,n){},"2ccb":function(t,e,n){"use strict";var a=n("8495"),i=n.n(a);i.a},4183:function(t,e,n){"use strict";var a=n("16d4"),i=n.n(a);i.a},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=n("58ca"),o=n("0284"),s=n.n(o),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"FullScreen",attrs:{id:"app"}},[n("ocean-canvas",{ref:"_ocean_canvas"}),n("PoemCanvas",{ref:"_poem_canvas"}),n("div",{staticClass:"CenterWrapper",attrs:{id:"_page"}},[n("div",{staticClass:"MainScreen"},[n("transition",{attrs:{name:"page-fade"}},[n("keep-alive",[n("router-view",{staticClass:"MainPage"})],1)],1)],1)])],1)},h=[],c=n("1e5c"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"_ocean_container"}})},u=[],m=(n("4de4"),n("d3b7"),n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("5a89")),d=22,f=5,p=.85,v="\n    varying vec2 vUv;\n    void main(){\n        vUv = uv;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n\n    }",g="\n    precision highp float;\n    uniform vec3 metaballs["+d+"];\n    uniform vec3 ocean_color[4];\n    uniform float tt;\n    \n    uniform float width;\n    uniform float height;\n    uniform float layer;\n    \n    uniform float roi_pos_x;\n    uniform float roi_pos_y;\n    uniform float roi_size_x;\n    uniform float roi_size_y;\n    varying vec2 vUv;\n    const vec3 BORDER_COLOR=vec3(0.02,0.22,0.48);\n    float rand(float n){return fract(sin(n) * 43758.5453123);}\n    float rand(vec2 n) { \n        return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n    }\n    float noise(float p){\n        float fl = floor(p);\n        float fc = fract(p);\n        return mix(rand(fl), rand(fl + 1.0), fc);\n    }\n    float noise(vec2 n) {\n        const vec2 d = vec2(0.0, 1.0);\n        vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n    }\n    vec2 mapCoord(vec2 p){\n        float ratio=width/height;\n        float rx=(p.x-.5)*ratio*roi_size_x+((roi_pos_x-.5)*ratio+.5);\n        float ry=-(p.y-.5)*roi_size_y+roi_pos_y;\n\n        return vec2(rx,ry);\n    }\n    vec4 getBlobColor(float val){\n        float step=val/5.0;\n        float pp=step-floor(step);\n        \n        vec4 bcolor;\n\n        pp=1.0;//-pp;\n        if(step>=layer*2.5) bcolor = vec4(ocean_color[0], 1.0);\n        else if(step>=layer*2.0) bcolor = vec4(mix(ocean_color[0],ocean_color[1],pp), 1.0);\n        else if(step>=layer*1.5) bcolor = vec4(mix(ocean_color[1],ocean_color[2],pp),1.0);\n        else if(step>=layer){\n            bcolor = vec4(mix(ocean_color[2],ocean_color[3],pp), 1.0);  \n        }else{\n            bcolor = vec4(ocean_color[3], 0.0);\n        }\n        return bcolor;\n    }\n   \n    void main(){\n        float ratio=width/height;\n        vec2 p=mapCoord(vUv.xy);\n        float x=p.x;\n        float y=p.y;\n        \n        float mx=x*ratio;\n        float my=y;\n        \n        float curve=40.0+layer*20.0;\n        \n        float v = 0.0;\n        float d=0.0;\n        for (int i = 0; i < "+d+"; i++) {\n            vec3 mb = metaballs[i];\n            float dx = ((mb.x-.5)*ratio+.5) - x;\n            float dy = mb.y - y;\n            float r = mb.z;\n            v += r*r/(dx*dx + dy*dy);\n            // v += r*r/(dx*dx + dy*dy);\n            d+=1.0/(dx*dx+dy*dy);\n\n            // if(mod(sqrt(d)*width,1.0)<0.01){\n            //     gl_FragColor=vec4(BORDER_COLOR,1.0);\n            //     return;\n            // }\n        }\n        v=v*(noise(vec2(x*ratio*curve+tt,y*curve+tt))*.5+.5);\n        d=d*noise(vec2(x*ratio*curve/5.0+tt,y*curve/5.0+tt)*.5+.5);\n        vec4 tmp;\n        if(mod(sqrt(d),0.5)<0.01) tmp=vec4(BORDER_COLOR,1.0);\n        else{\n            tmp=getBlobColor(v);\n        }\n        gl_FragColor=tmp;\n    }\n    ",_="\n    precision highp float;\n    uniform vec3 metaballs["+f+"];\n    uniform vec3 ocean_color[4];\n    uniform float tt;\n    uniform sampler2D mask;\n    uniform float width;\n    uniform float height;\n    varying vec2 vUv;\n    uniform vec3 ISLAND_COLOR[4];\n    // uniform float ISLAND_PORTION;\n    // uniform float ISLAND_CENTER;\n    uniform vec4 mask_region;\n    uniform float roi_pos_x;\n    uniform float roi_pos_y;\n    uniform float roi_size_x;\n    uniform float roi_size_y;\n    float rand(float n){return fract(sin(n) * 43758.5453123);}\n    float rand(vec2 n) { \n        return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n    }\n    float noise(float p){\n        float fl = floor(p);\n        float fc = fract(p);\n        return mix(rand(fl), rand(fl + 1.0), fc);\n    }\n    float noise(vec2 n) {\n        const vec2 d = vec2(0.0, 1.0);\n        vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n    }\n    bool inMask(vec2 p){\n        \n        if(p.x<mask_region[0] || p.y<mask_region[1] \n            || p.x>mask_region[0]+mask_region[2] || p.y>mask_region[1]+mask_region[3]) return false;\n\n        float mx=(p.x-mask_region[0])/mask_region[2];\n        float my=(p.y-mask_region[1])/mask_region[3];\n        \n        vec4 mask_=texture2D(mask,vec2(mx,1.0-my));\n        bool in_mask=(length(mask_.rgb)>1.0);\n        \n        return in_mask;\n        // return true;\n    }\n     vec2 mapCoord(vec2 p){\n        float ratio=width/height;\n        float rx=(p.x-.5)*roi_size_x+((roi_pos_x-.5)*ratio+.5);\n        float ry=-(p.y-.5)*roi_size_y+roi_pos_y;\n        // ry=1.0-ry;\n\n        return vec2(rx,ry);\n    }\n    void main(){\n        float ratio=width/height;\n        vec2 p=mapCoord(vUv.xy);\n        float x=p.x;\n        float y=p.y;\n        \n        // float mx=(vUv.x-.5)*ratio+.5;\n        // float my=vUv.y;\n        float v = 0.0;\n        float d=0.0;\n        for (int i = 0; i < "+f+"; i++) {\n            vec3 mb = metaballs[i];\n            float dx = mb.x - x;\n            float dy = mb.y - y;\n            float r = mb.z;\n            v += r*r/(dx*dx + dy*dy);\n            d+=sqrt(r*r/(dx*dx + dy*dy));\n        }\n        v=v*(noise(vec2(x*ratio*20.0+tt,y*20.0+tt))*.5+.5);\n        bool in_mask=inMask(p);\n        vec4 tmp=vec4(ocean_color[3],.2);\n        vec4 dest=vec4(mix(ISLAND_COLOR[2],ISLAND_COLOR[3],y),tt);\n        // if(v > 1.0){\n            tmp=vec4(ocean_color[3], .2);\n            float step=floor(v/4.0);\n            float pp=1.0;\n            if(step>=6.0) tmp =vec4(ocean_color[0], 1.0);\n            else if(step>=5.0) tmp =vec4(ocean_color[1], 1.0);\n            else if(step>=4.0) tmp =vec4(ocean_color[2], 1.0);\n\n            // if(tt>0.0 && !in_mask) tmp=vec4(ocean_color[3],.2);\n        // }\n        if(in_mask){\n            dest=vec4(mix(ISLAND_COLOR[0],ISLAND_COLOR[1],y),1.0);\n        }\n        float t=.0;\n        if(tt<.5) t=.0;\n        else t=(tt-.5)*2.0;\n        gl_FragColor=vec4(mix(tmp,dest,t));\n    }\n    ",y=n("d4ec"),x=n("bee2"),w=n("cffa"),b=n("a5cf"),C=.5,O=5e3,k=300,$=10,S=function(){function t(e,n){Object(y["a"])(this,t),this.width=e,this.height=n;var a=this.randomRadius(C);this.x=Math.random()*(e+a)-a,this.y=Math.random()*(n+a)-a,this.r=a,this.tween,this.setDest(),this.stage="floating",this.is_tw=!1}return Object(x["a"])(t,[{key:"atDest",value:function(){return!this.tween.isActive()}},{key:"step",value:function(){this.atDest()&&"floating"===this.stage&&this.setDest()}},{key:"setDest",value:function(t,e,n,a){var i=0;void 0===n&&(n=O*(1*Math.random()+1),i=n*Math.random()*.5/1e3),void 0===a&&(a=C);var o=this.randomRadius(a);void 0===t&&(t=Math.random()*(this.width+this.r)-this.r),void 0===e&&(e=Math.random()*(this.height+this.r)-this.r),t=Math.min(Math.max(t,0),this.width),e=Math.min(Math.max(e,0),this.height),this.tween&&this.tween.kill(),this.tween=w["a"].to(this,n/1e3,{x:t,y:e,r:o,overwrite:"all",ease:b["d"].easeInOut,delay:i})}},{key:"randomRadius",value:function(t){var e=(.5*Math.random()+.5)*Math.min(this.width,this.height)*t;return Math.min(Math.max(e,$),k)}}]),t}(),M=3e3,P={name:"ocean-canvas",data:function(){return{camera:null,scene:null,renderer:null,mesh_ocean:null,mesh_taiwan:null,width:this.$store.state.screenWidth,height:this.$store.state.screenHeight,spots:[],material_ocean:null,material_taiwan:null,stage:"floating"}},watch:{"$store.state.screenWidth":function(t){this.width=t,this.resize()},"$store.state.screenHeight":function(t){this.height=t,this.resize()}},methods:{init:function(){var t=document.getElementById("_ocean_container");this.camera=new m["f"](70,t.clientWidth/t.clientHeight,.01,10),this.camera.position.z=1,this.scene=new m["h"];for(var e=t.clientWidth/t.clientHeight,n=this.camera.fov*Math.PI/180,a=2*Math.tan(n/2),i=a*e,o=new m["g"](i,a,1,1),s=0;s<d;++s){var r=new S(this.width,this.height);s<f&&(r.is_tw=!0),this.spots.push(r)}var h=this.$store.getters.getMaskRegion;this.material_ocean=new m["i"]({uniforms:{ocean_color:{value:new Float32Array([0,.375,.62,.08,.375,.65,.16,.52,.68,.25,.59,.72])},metaballs:{value:new Float32Array(3*d)},tt:{value:0},width:{value:this.width},height:{value:this.height},layer:{value:5},roi_pos_x:{value:.5},roi_pos_y:{value:.5},roi_size_x:{value:1},roi_size_y:{value:1}},transparent:!0,vertexShader:v,fragmentShader:g}),this.material_taiwan=new m["i"]({uniforms:{mask:{type:"t",value:(new m["l"]).load("img/taiwan_mask.png")},ocean_color:{value:new Float32Array([0,.375,.62,.08,.375,.65,.16,.52,.68,.25,.59,.72])},metaballs:{value:new Float32Array(3*d)},tt:{value:0},width:{value:i},height:{value:a},ISLAND_COLOR:{value:new Float32Array([55/256,186/256,.71875,43/256,121/256,180/256,19/256,.625,182/256,18/256,86/256,142/256])},mask_region:{value:new Float32Array([h.x/this.width,h.y/this.height,h.w/this.width,h.w/this.height])},roi_pos_x:{value:.5},roi_pos_y:{value:.5},roi_size_x:{value:1},roi_size_y:{value:1}},transparent:!0,vertexShader:v,fragmentShader:_}),this.mesh_ocean=new m["d"](o,this.material_ocean),w["a"].to(this.material_ocean.uniforms.tt,6,{value:10,yoyo:!0,repeat:-1}),this.mesh_taiwan=new m["d"](o,this.material_taiwan),this.scene.add(this.mesh_taiwan),this.scene.add(this.mesh_ocean),this.renderer=new m["m"]({antialias:!0,alpha:!0}),this.renderer.setClearColor(16777215,0),this.renderer.sortObjects=!1,this.renderer.setSize(t.clientWidth,t.clientHeight),t.appendChild(this.renderer.domElement)},animate:function(){var t=0;for(t=0;t<d;++t)this.spots[t].step(this.width,this.height);if("island"===this.stage||"poem"===this.stage){var e=this.packSpots(this.spots.filter((function(t){return!t.is_tw})),d),n=this.packSpots(this.spots.filter((function(t){return t.is_tw})));this.material_ocean.uniforms.metaballs.value=e,this.material_taiwan.uniforms.metaballs.value=n}else{var a=this.packSpots(this.spots);this.material_ocean.uniforms.metaballs.value=a,this.material_taiwan.uniforms.metaballs.value=new Float32Array(3*f)}this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate)},packSpots:function(t,e){void 0==e&&(e=t.length);for(var n=new Float32Array(3*e),a=0;a<t.length;a++){var i=3*a,o=t[a];n[i+0]=o.x/this.width,n[i+1]=o.y/this.height,n[i+2]=o.r/this.height}return n},resize:function(){console.log("ocean canvas shader resize!"),this.material_ocean.uniforms.width.value=this.width,this.material_ocean.uniforms.height.value=this.height;var t=this.$store.getters.getMaskRegion;this.material_taiwan.uniforms.mask_region.value=new Float32Array([t.x/this.width,t.y/this.height,t.w/this.width,t.w/this.height]);for(var e=0;e<d;++e)if(this.spots[e].width=this.width,this.spots[e].height=this.height,"island"===this.stage)if(this.spots[e].is_tw){var n=this.$store.getters.getIslandPositionCanvas(e);this.spots[e].setDest(n.x,n.y,.1*M,n.r)}else{var a=e-f,i=this.$store.getters.getOceanPositionCanvas(a);this.spots[e].setDest(i.x,i.y,.1*M,.25)}var o=this.width/this.height,s=this.camera.fov*Math.PI/180,r=2*Math.tan(s/2),h=r*o,c=new m["g"](h,r,1,1);this.camera.aspect=o,this.camera.updateProjectionMatrix(),this.mesh_ocean.geometry=c,this.mesh_taiwan.geometry=c,this.renderer.setSize(this.width,this.height),this.renderer.render(this.scene,this.camera)},goIsland:function(){var t;for(t=0;t<d;++t)if(this.spots[t].stage="island",this.spots[t].is_tw){var e=this.$store.getters.getIslandPositionCanvas(t);this.spots[t].setDest(e.x,e.y,M,e.r)}else{var n=t-f,a=this.$store.getters.getOceanPositionCanvas(n);this.spots[t].setDest(a.x,a.y,M,.25)}w["a"].to(this.material_taiwan.uniforms.tt,M/1e3*.5,{value:1,delay:M/1e3*.5}),w["a"].to(this.material_ocean.uniforms.layer,M/1e3,{value:5}),this.setShaderROI(.5,.5,1,1,.5*M,0)},goFloat:function(){var t;for(t=0;t<d;++t)this.spots[t].stage="floating",this.spots[t].setDest(void 0,void 0,M);w["a"].to(this.material_taiwan.uniforms.tt,M/1e3,{value:0}),w["a"].to(this.material_ocean.uniforms.layer,M/1e3,{value:1}),this.setShaderROI(.5,.5,1,1,2*M,0)},goPoem:function(t){console.log("go poem!"),t+=f,w["a"].to(this.material_taiwan.uniforms.mask_tt,M/1e3,{value:1}),w["a"].to(this.material_ocean.uniforms.layer,M/1e3,{value:4}),this.setShaderROI(this.spots[t].x/this.width,this.spots[t].y/this.height,.1,.1,.5*M,0)},setShaderROI:function(t,e,n,a,i,o){w["a"].to(this.material_ocean.uniforms.roi_pos_x,i/1e3,{value:t,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_ocean.uniforms.roi_pos_y,i/1e3,{value:e,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_ocean.uniforms.roi_size_x,i/1e3,{value:n,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_ocean.uniforms.roi_size_y,i/1e3,{value:a,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_taiwan.uniforms.roi_pos_x,i/1e3,{value:t,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_taiwan.uniforms.roi_pos_y,i/1e3,{value:e,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_taiwan.uniforms.roi_size_x,i/1e3,{value:n,delay:o,ease:b["a"].easeOut}),w["a"].to(this.material_taiwan.uniforms.roi_size_y,i/1e3,{value:a,delay:o,ease:b["a"].easeOut})},setStage:function(t,e){switch(t){case"floating":this.goFloat();break;case"island":this.goIsland();break;case"poem":this.goPoem(e);break}this.stage=t}},mounted:function(){this.init(),this.animate()}},j=P,R=(n("6495"),n("2877")),z=Object(R["a"])(j,l,u,!1,null,"3130a798",null),D=z.exports,I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"_poem_container"}})},W=[],A=(n("99af"),n("3835")),H=(n("38cf"),2e3),T=30,E=1.5*T,L=32,F=-2200,B=function(){function t(e,n,a,i,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,r=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0;Object(y["a"])(this,t),this.color=o,this.createObject(e),this.tween,this.setDest(n,a,i,s,r,h),this.repeat=s,this.stage="floating"}return Object(x["a"])(t,[{key:"createObject",value:function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.fillStyle="transparant",this.canvas.width=L,this.canvas.height=L,this.context.textAlign="center",this.context.textBaseline="middle",this.context.font=T+"px Noto Sans TC",this.drawText(t),this.texture=new m["a"](this.canvas),this.texture.needsUpdate=!0,this.texture.minFilter=m["c"],this.material=new m["k"]({map:this.texture,color:16777215,fog:!0,depthWrite:!1});var e=new m["j"](this.material);this.textObject=new m["e"],this.textObject.textHeight=L,this.textObject.textWidth=L,e.scale.set(T,T,1),this.textObject.add(e)}},{key:"drawText",value:function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.context.fillText(t,L/2,L/2),this.texture&&(this.texture.needsUpdate=!0)}},{key:"updateChar",value:function(t,e,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,s=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0;this.color=i,this.drawText(t),this.setDest(e,n,a,o,s,r)}},{key:"atDest",value:function(){return!this.tween.isActive()}},{key:"setDest",value:function(t,e,n,a,i,o){var s=H*(1*Math.random()+1);void 0===i&&Math.random();var r=Math.random();this.textObject.position.x=t*r,this.textObject.position.y=e*r,this.textObject.position.z=F,o.to(this.textObject.position,{x:t,y:e,z:n,overwrite:"all",repeat:a,duration:s/1e3},i/1e3)}},{key:"reset",value:function(){this.textObject.position.z=F}},{key:"restart",value:function(){this.fadeIn()}},{key:"setRepeat",value:function(t){this.tween.repeat(t)}},{key:"fadeOut",value:function(){this.tween_fade&&this.tween_fade.kill(),this.tween_fade=w["a"].to(this.material,3,{opacity:0})}},{key:"fadeIn",value:function(){this.tween_fade&&this.tween_fade.kill(),this.tween_fade=w["a"].to(this.material,3,{opacity:1,delay:1})}}]),t}(),N=40,U=200,q="#E8FFD3",G="white",Z=100,J=5e3,V={name:"poem-canvas",data:function(){return{camera:null,scene:null,renderer:null,width:this.$store.state.screenWidth,height:this.$store.state.screenHeight,dummy_text:[],poem_text:[],cameraZ:2e3,stage:"floating",author:"漂浮繆斯",poem_group:new m["b"],poem_timeline:null,dummy_timeline:null,dummy_material:[]}},computed:{textwidth:function(){return this.$store.state.pageWidth},destZ:function(){var t=this.camera.fov*Math.PI/180;return this.height/(2*Math.tan(t/2))}},watch:{"$store.state.screenWidth":function(t){this.width=t,this.resize()},"$store.state.screenHeight":function(t){this.height=t,this.resize()}},methods:{init:function(){var t=document.getElementById("_poem_container");this.camera=new m["f"](60,t.clientWidth/t.clientHeight,.01,this.cameraZ),this.camera.position.z=0,this.scene=new m["h"],this.scene.add(this.poem_group),this.renderer=new m["m"]({antialias:!0,alpha:!0}),this.renderer.setClearColor(16777215,0),this.renderer.sortObjects=!1,this.renderer.setSize(t.clientWidth,t.clientHeight),t.appendChild(this.renderer.domElement),this.poem_timeline=new w["c"].timeline({defaults:{duration:1,ease:b["d"].easeInOut},autoRemoveChildren:!0}),this.dummy_timeline=new w["c"].timeline({defaults:{duration:1,ease:b["d"].easeInOut}}),this.resetChar()},resize:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),"poem"===this.state&&this.renderer.render(this.scene,this.camera)},animate:function(){"poem"===this.stage&&this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate)},addWeather:function(t,e,n){this.tween_fade&&this.tween_fade.kill();var a=this.dummy_timeline;this.tween_fade=w["c"].to(this.dummy_material,3,{opacity:0,onComplete:function(){a.pause()}}),this.poem_timeline.clear();var i=0;for(m in t)i+=t[m].poem.length+1,t[m].concat&&(i-=1);console.log("#line= "+i);var o=0,s=0,r=0,h=0,c=0,l=this.camera.position.z-this.destZ,u=J;for(var m in t){var d=t[m].text,f=this.addLine(r,d,o,s,l,q,0,0),p=Object(A["a"])(f,3);r=p[0],s=p[1],h=p[2];var v=t[m].poem;for(var g in v)if(0==g&&t[m].concat){s+=E;var _=this.addLine(r,v[g],h,s,l,G,0,u),y=Object(A["a"])(_,3);r=y[0],s=y[1],h=y[2],c=Math.max(c,h)}else{var x=this.addLine(r,v[g],o,s,l,G,0,u),b=Object(A["a"])(x,3);r=b[0],s=b[1],h=b[2],c=Math.max(c,h)}}var C=J+H,O=c,k=s-E,$=this.addLine(r,this.author,O-this.author.length*T,k,l,G,0,C),S=Object(A["a"])($,3);r=S[0],k=S[1],h=S[2],c=Math.max(c,h),k-=E;var M=this.addLine(r,e,O-e.length*T,k,l,G,0,C),P=Object(A["a"])(M,3);r=P[0],k=P[1],h=P[2],c=Math.max(c,h);var j=this.addLine(r,n,O-n.length*T*.5,k,l,G,0,C),R=Object(A["a"])(j,3);r=R[0],k=R[1],h=R[2],c=Math.max(c,h);var z=Math.min(this.textwidth/(c-o),.8*this.$store.state.pageHeight/Math.abs(k));return z=Math.min(1,z),this.poem_group.scale.set(z,z,1),this.poem_group.position.x=-c/2*z,this.poem_group.position.y=-k/2*z,this.poem_timeline.restart(),[u,C]},addLine:function(t,e,n,a,i,o,s,r){var h=0,c=0,l=a;for(var u in e)c+=T*(this.isASCII(e[u])?-.25:0),this.addChar(t,e[u],c+n,l,i,o,0,h+r),c+=T*(this.isASCII(e[u])?.75:1),h+=Z,t++;return l-=E,[t,l,c+n]},addChar:function(t,e,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"white",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,r=arguments.length>7?arguments[7]:void 0,h=-1==s?this.dummy_text:this.poem_text,c=-1==s?this.dummy_timeline:this.poem_timeline;t<h.length?h[t].updateChar(e,n,a,i,o,s,r,c):this.insertChar(e,n,a,i,o,s,r)},insertChar:function(t,e,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,s=arguments.length>6?arguments[6]:void 0,r=-1==o?this.dummy_timeline:this.poem_timeline,h=new B(t,void 0!==e?e:Math.random()*this.width-this.width/2,void 0!==n?n:Math.random()*this.height-this.height/2,void 0!==a?a:0,i,o,s,r);-1==o?(this.dummy_text.push(h),this.scene.add(h.textObject)):(this.poem_text.push(h),this.poem_group.add(h.textObject))},isASCII:function(t){return t.charCodeAt(0)<128},clear:function(){for(var t in this.poem_text)this.poem_text[t].reset();for(t in this.dummy_text)this.dummy_text[t].reset();this.renderer.clear(),this.dummy_timeline.pause(),this.poem_timeline.pause()},resetChar:function(){var t=Math.floor(1e3*Math.random());for(var e in this.dummy_text){var n=this.$store.getters.getDummyChar(e+t);this.dummy_text[e].drawText(n)}this.tween_fade&&this.tween_fade.kill(),this.tween_fade=w["c"].to(this.dummy_material,3,{opacity:1,startAt:{opacity:0}}),this.dummy_timeline.resume()},setStage:function(t){this.clear(),"poem"===t&&this.resetChar(),this.stage=t}},created:function(){},mounted:function(){console.log("wave canvas mounted!"),this.init();for(var t=0;t<N;++t)this.insertChar(this.$store.getters.getDummyChar(t));for(t=0;t<U;++t)this.insertChar("A",0,0,0,q,0,0);for(t in this.dummy_text)this.dummy_material.push(this.dummy_text[t].material);this.dummy_timeline.play(),this.animate()}},Y=V,K=(n("2ccb"),Object(R["a"])(Y,I,W,!1,null,"ef600a42",null)),Q=K.exports,X={data:function(){return{sound_bgm:null,sound_processing:null,sound_fadein:null,sound_finish:null}},components:{OceanCanvas:D,PoemCanvas:Q},created:function(){this.$store.dispatch("fetchIslandData"),this.$store.dispatch("fetchDummyChar"),this.loadSound()},methods:{setStage:function(t,e){this.$refs._ocean_canvas.setStage(t,e),this.$refs._poem_canvas.setStage(t),this.sound_fadein.stop(),this.sound_finish.stop(),"poem"!==t&&this.sound_processing.stop()},loadSound:function(){this.sound_bgm=new c["Howl"]({src:["audio/back.wav"]}),this.sound_bgm.loop(!0),this.sound_processing=new c["Howl"]({src:["audio/processing.wav"]}),this.sound_processing.loop(!0),this.sound_fadein=new c["Howl"]({src:["audio/fadein.wav"]}),this.sound_finish=new c["Howl"]({src:["audio/finish.wav"]})}}},tt=X,et=(n("5c0b"),Object(R["a"])(tt,r,h,!1,null,null,null)),nt=et.exports,at=n("8c4f"),it=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CenterWrapper",on:{click:t.startClick}},[t._m(0)])},ot=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CenterWrapper",attrs:{id:"_title"}},[n("img",{attrs:{src:"img/title.png",id:"_title"}}),n("div",{staticClass:"HintRegion",attrs:{id:"hint1"}},[t._v(" 從台灣沿海氣象預報"),n("br"),t._v(" 為你寫一首詩 ")])])}],st={name:"PageHome",components:{},data:function(){return{date_str:(new Date).toLocaleString()}},methods:{startClick:function(){this.$router.push("map"),this.$parent.sound_bgm.playing()||this.$parent.sound_bgm.play()},update:function(){requestAnimationFrame(this.update)}},activated:function(){this.$parent.setStage("floating")}},rt=st,ht=(n("4183"),Object(R["a"])(rt,it,ot,!1,null,null,null)),ct=ht.exports,lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"_map",staticClass:"CenterWrapper",attrs:{id:"_map"}},[t._m(0),t._l(t.ocean,(function(e){return n("ocean-item",{key:e.name,attrs:{ocean:e},nativeOn:{click:function(n){return t.writePoem(e.index,e.name)}}})}))],2)},ut=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"HintRegion",attrs:{id:"_map_hint"}},[n("div",[t._v("你今天的心情"),n("br"),t._v(" 想看看哪一片海？")])])}],mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"OceanItem",style:t.style},[n("span",[t._v(t._s(t.ocean.name))])])},dt=[],ft={name:"ocean-item",props:["ocean"],computed:{style:function(){var t=this.$store.getters.getOceanPosition(this.ocean.index);return{left:t.x+"px",top:t.y+"px"}}},methods:{}},pt=ft,vt=(n("a9b8"),Object(R["a"])(pt,mt,dt,!1,null,"bdbf17ea",null)),gt=vt.exports,_t=n("bc3a"),yt=n.n(_t),xt=n("a7fe"),wt=n.n(xt);a["a"].use(wt.a,yt.a);var bt="https://opendata.cwb.gov.tw/fileapi/v1/opendataapi/F-A0012-001?Authorization=CWB-7021ACD5-3924-4A8B-8C5F-58BF57C9F18B&downloadType=WEB&format=JSON",Ct={Wx:"天氣",WindDir:"風向",WindSpeed:"風力",WaveHeight:"浪高",WaveType:"海浪"},Ot={data:function(){return{ocean_list:[],show:!1,sleeptimeout:null}},computed:{ocean:function(){return this.$store.state.ocean}},components:{OceanItem:gt},methods:{writePoem:function(t,e){var n;for(var a in this.ocean_list)if(this.ocean_list[a].locationName===e){n=this.ocean_list[a];break}if(n){this.$parent.sound_processing.playing()||this.$parent.sound_processing.play();var i=this;i.poem="waiting...",console.log("write a poem for "+n.locationName),this.$store.commit({type:"setLocation",loc:n.locationName});var o=[];for(var s in n.weatherElement){var r=n.weatherElement[s],h=Ct[r["elementName"]]+r["time"][0]["parameter"]["parameterName"];o.push(h)}console.log(o),this.$store.commit("setWeatherText",o),this.$store.dispatch("generatePoem"),i.$router.push({name:"poem",params:{text:o}}),this.$parent.setStage("poem",parseInt(t)),this.$parent.sound_bgm.playing()||this.$parent.sound_bgm.play(),clearTimeout(this.sleeptimeout)}else console.log("err location: "+e)},beforeEnter:function(t){t.style.opacity=0,t.style.height=0},enter:function(t,e){},leave:function(t,e){}},created:function(){console.log("map created");var t=this;a["a"].axios.get(bt).then((function(e){var n=e.data.cwbopendata.dataset.location;t.ocean_list=n}))},mounted:function(){var t=this;this.$store.dispatch("computePageSize"),this.$parent.$refs._ocean_canvas.resize(),clearTimeout(this.sleeptimeout),this.sleeptimeout=setTimeout((function(){t.$router.push({name:"home"}),console.log("timeout!")}),this.$store.state.timeoutInterval)},activated:function(){var t=this;console.log("page map activated!"),this.$parent.setStage("island"),clearTimeout(this.sleeptimeout),this.sleeptimeout=setTimeout((function(){t.$router.push({name:"home"}),console.log("timeout!")}),this.$store.state.timeoutInterval)},deactivated:function(){console.log("page map deactivated!"),clearTimeout(this.sleeptimeout)}},kt=Ot,$t=(n("ebd1"),Object(R["a"])(kt,lt,ut,!1,null,"119fe380",null)),St=$t.exports,Mt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("keep-alive",[n("div",{staticClass:"ButtonRegion",style:t.show_button?"display:block;":"display:none;"},[n("div",{staticClass:"Button",on:{click:t.rewriteClick}},[n("img",{attrs:{src:"img/hint-3.png",id:"hint3"}})]),n("div",{staticClass:"Button",on:{click:t.homeClick}},[n("img",{attrs:{src:"img/hint-4.png",id:"hint4"}})])])])],1)},Pt=[],jt=(n("a15b"),{data:function(){return{show_button:(new Date).toLocaleString(),sleeptimeout:null}},components:{},watch:{"$store.state.generating":function(t){t||this.startPoem()}},computed:{date_str:function(){var t=new Date,e=t.getMonth(),n=t.getDate();return t.getFullYear()+"/"+this.pad(e+1,2)+"/"+this.pad(n,2)},location:function(){return this.$store.state.location},poem:function(){return this.$store.state.poem},generating:function(){return this.$store.state.generating}},methods:{rewriteClick:function(){this.show_button=!1,this.$parent.$refs._poem_canvas.clear(),this.$parent.$refs._poem_canvas.resetChar(),this.$store.dispatch("generatePoem"),this.$parent.sound_bgm.playing()||this.$parent.sound_bgm.play(),clearTimeout(this.sleeptimeout)},homeClick:function(){this.$parent.sound_bgm.playing()||this.$parent.sound_bgm.play(),this.$router.push({name:"home"})},pad:function(t,e,n){return n=n||"0",t+="",t.length>=e?t:new Array(e-t.length+1).join(n)+t},startPoem:function(){var t,e,n=this;this.show_button=!1;var a=this.$parent.$refs["_poem_canvas"].addWeather(this.poem,this.location,this.date_str),i=Object(A["a"])(a,2);t=i[0],e=i[1],this.$parent.sound_processing.stop(),this.$parent.sound_finish.play();var o=this.$parent.sound_fadein;setTimeout((function(){o.play()}),t),setTimeout((function(){n.show_button=!0,w["b"].from(".ButtonRegion",{opacity:0,duration:1}),clearTimeout(n.sleeptimeout),n.sleeptimeout=setTimeout((function(){n.$router.push({name:"home"}),console.log("timeout!")}),n.$store.state.timeoutInterval+e)}),e+3e3)}},created:function(){},mounted:function(){this.generating||this.$router.push({name:"home"})},activated:function(){this.show_button=!1,this.generating||this.$router.push({name:"home"})},updated:function(){console.log("poem view updated!")},deactivated:function(){clearTimeout(this.sleeptimeout)}}),Rt=jt,zt=(n("d3aa"),Object(R["a"])(Rt,Mt,Pt,!1,null,"119a5b7c",null)),Dt=zt.exports,It=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Wt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CenterWrapper",attrs:{id:"_floor"}},[n("div",{staticClass:"CenterWrapper"})])}],At={name:"PageFloor",mounted:function(){console.log("floor mounted!"),this.$parent.setStage("floating")},activated:function(){console.log("floor activated!"),this.$parent.setStage("floating")}},Ht=At,Tt=Object(R["a"])(Ht,It,Wt,!1,null,null,null),Et=Tt.exports;a["a"].use(at["a"]);var Lt=new at["a"]({routes:[{name:"home",path:"/",component:ct},{name:"map",path:"/map",component:St},{name:"poem",path:"/poem",component:Dt,props:!0},{name:"floor",path:"/floor",component:Et}]}),Ft=Lt,Bt=(n("a434"),n("ac1f"),n("5319"),n("1276"),n("2f62")),Nt="https://mmlab.tw/muse/sea",Ut="./data/ocean_data.json",qt="./data/dummy_char.txt",Gt=.5;function Zt(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),a=[t[n],t[e]];t[e]=a[0],t[n]=a[1]}}a["a"].use(Bt["a"]),a["a"].use(wt.a,yt.a);var Jt,Vt=new Bt["a"].Store({state:{location:"",poem:[],generating:!1,ocean:[],island:[],screenWidth:document.documentElement.clientWidth,screenHeight:document.documentElement.clientHeight,pageWidth:0,pageHeight:0,maskRegion:{},pagePadding:Gt,dummyChar:[],timeoutInterval:6e4},mutations:{setWeatherText:function(t,e){for(var n in t.poem=[],e)t.poem.push({text:e[n]})},setLocation:function(t,e){t.location=e.loc},setPoem:function(t,e){for(var n in t.poem){var a=e[n].replace(t.poem[n].text,""),i="\n"!==a[0],o=a.split("\n");o=o.filter((function(t){return t.length>0}));var s={text:t.poem[n].text,poem:o,concat:i};t.poem.splice(n,1,s)}},setGenerating:function(t,e){t.generating=e},clearPoem:function(t){for(var e in t.poem){var n={text:t.poem[e].text};t.poem.splice(e,1,n)}},setOceanData:function(t,e){t.ocean=e},setIslandData:function(t,e){t.island=e},setDummyChar:function(t,e){t.dummyChar=e},setPageSize:function(t){t.screenWidth=document.documentElement.clientWidth,t.screenHeight=document.documentElement.clientHeight;var e=document.getElementsByClassName("MainPage")[0];t.pageWidth=e.clientWidth,t.pageHeight=e.clientHeight,console.log(t.pageWidth+" , "+t.pageHeight);var n=Math.min(t.pageWidth/.8,t.pageHeight*p),a=t.screenWidth/2-n/2,i=t.screenHeight/2-t.pageHeight/2+.2*t.pageHeight;t.maskRegion={x:a,y:i,w:n}}},actions:{generatePoem:function(t){var e=this,n=t.commit;n("setGenerating",!0),n("clearPoem");var i=[];for(var o in this.state.poem)i.push(this.state.poem[o].text);a["a"].axios.post(Nt,i).then((function(t){console.log("res=> ",t);var e=t.data.split("#");n("setPoem",e),n("setGenerating",!1)})).catch((function(t){console.log(t);for(var a=[],i=0;i<e.state.poem.length;++i)a.push("############");n("setPoem",a),n("setGenerating",!1)}))},fetchIslandData:function(t){var e=t.commit;a["a"].axios.get(Ut).then((function(t){var n=[],a=t.data.main.h/2;for(var i in t.data.ocean){var o=t.data.ocean[i];o.x/=a,o.y/=a,o.w/=a,o.h/=a,o.index=i,n.push(o)}var s=[];for(i in t.data.island){var r=t.data.island[i];r.x/=a,r.y/=a,r.w/=a,r.h/=a,r.index=i,r.r/=a,s.push(r)}e("setOceanData",n),e("setIslandData",s),console.log("load ocean data!")})).catch((function(t){console.log(t)}))},fetchDummyChar:function(t){var e=t.commit;a["a"].axios.get(qt).then((function(t){var n=t.data.split("");Zt(n),e("setDummyChar",n),console.log("load dummyChars!")})).catch((function(t){console.log(t)}))},computePageSize:function(t){var e=t.commit;e("setPageSize")}},getters:{getWeatherText:function(t){return t.weather_text},getPoem:function(t){return t.poem},getOceanPosition:function(t){return function(e){var n=t.maskRegion.x-(t.screenWidth-t.pageWidth)/2,a=t.maskRegion.y-(t.screenHeight-t.pageHeight)/2,i=t.maskRegion.w/2;return{x:n+i+t.ocean[e].x*i,y:a+i+t.ocean[e].y*i}}},getOceanPositionCanvas:function(t){return function(e){var n=t.maskRegion.w/2;return{x:t.maskRegion.x+n+t.ocean[e].x*n,y:t.maskRegion.y+n+t.ocean[e].y*n}}},getIslandPositionCanvas:function(t){return function(e){if(e<0||e>=t.island.length)return{x:0,y:0,r:0};var n=t.maskRegion.w/2;return{x:t.maskRegion.x+n+t.island[e].x*n,y:t.maskRegion.y+n+t.island[e].y*n,r:t.island[e].r}}},getDummyChar:function(t){return function(e){var n=t.dummyChar[e%t.dummyChar.length];return n}},getMaskRegion:function(t){return t.maskRegion},getSleepTimeout:function(t){return t.timeoutInterval}}}),Yt=Vt;a["a"].use(i["a"]),a["a"].use(s.a,{id:"UA-80306203-11",router:Ft,autoTracking:{screenview:!0}}),a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(nt)},router:Ft,store:Yt,mounted:function(){var t=this;window.onresize=function(){clearTimeout(Jt),Jt=setTimeout(t.doResize,10)},this.doResize()},created:function(){},methods:{doResize:function(){console.log("resize!"),this.$store.dispatch("computePageSize")}}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";var a=n("9c0c"),i=n.n(a);i.a},6495:function(t,e,n){"use strict";var a=n("2015"),i=n.n(a);i.a},8495:function(t,e,n){},"9c0c":function(t,e,n){},a066:function(t,e,n){},a9b8:function(t,e,n){"use strict";var a=n("f5fa"),i=n.n(a);i.a},d3aa:function(t,e,n){"use strict";var a=n("e8e2"),i=n.n(a);i.a},e8e2:function(t,e,n){},ebd1:function(t,e,n){"use strict";var a=n("a066"),i=n.n(a);i.a},f5fa:function(t,e,n){}});
//# sourceMappingURL=app.be93ceeb.js.map